# Push

## Integrated Friends

The domestic Push function is developed based on Youmeng push. Please refer to [Youmeng Document](https://developer.umeng.com/docs/66632/detail/66744) to integrate Youmeng into the project. Tuya Cloud supports Youmeng For third-party channels of Mengmeng, if you need channels for Xiaomi, Huawei, and Meizu, apply for each platform and initialize them according to the documents of Umeng

### Configuration information

You can refer to the document [**Youmeng Push Key Application Process**] (https://docs.tuya.com/docDetail?code=K8uhkjmak2nn8)

Copy the applied app key and other information to "APP Workbench"-"APP SDK"-the configuration of the corresponding application,

> [!DANGER] Do not configure the information incorrectly:
>
> * Confirm that the package name of the Umeng backend is consistent with the package name of the sdk application
> * Don't configure Umeng Message Secret and App Master Secret reversely
> * Youmeng background "Enable server IP address" needs to be turned off manually

<img src="images/push_umeng_config.png" style="zoom: 33%;" />

### Set user alias

After ensuring that Youmeng has been integrated into the project, set the user id through the Youmeng SDK, and push messages to the user according to the user id when pushing

```java
PushAgent mPushAgent = PushAgent.getInstance(this)
mPushAgent.setAlias(aliasId, ALIAS_TYPE, new UTrack.ICallBack() {
     @Override
     public void onMessage(boolean isSuccess, String message) {
     }
});
```

**Parameter Description**

| Parameters | Description                                                  |
| ---------- | ------------------------------------------------------------ |
| aliasId    | Can be a unique id automatically generated by your application for each user |
| ALIAS_TYPE | Need to fill in "TUYA_SMART"                                 |

### Register Tuya Cloud Push

Register aliasId to Tuya Cloud, (required!)

**Parameter Description**

| Parameters   | Description                                                  |
| ------------ | ------------------------------------------------------------ |
| aliasId      | User alias Register the alias obtained in the previous step to Tuya Cloud, and Tuya Cloud will send messages to the app with this alias |
| pushProvider | Register push category, Youmeng needs to fill in: "umeng"    |

**Sample Code**

```java
 TuyaCommunitySDK.getCommunityPushInstance().registerDevice(String aliasId, String pushProvider, new IResultCallback() {
    @Override
    public void onError(String code, String error) {
    }

    @Override
    public void onSuccess() {

    }
});
```

### Third-party channel settings

If you use the third-party channel of Youmeng, the activity of the pop-up window must be named SpecialPushActivity.

Take Xiaomi as an example, SpecialPushActivity inherits from UmengNotifyClickActivity, and the complete package name path is `com.activity.SpecialPushActivity`.

### Push message reception

For information on how to integrate the custom message of Youmeng, please refer to the access document of Youmeng-Custom Message (Message Transparent Transmission)

E.g:

```java
UmengMessageHandler messageHandler = new UmengMessageHandler(){
    @Override
    public void dealWithCustomMessage(final Context context, final UMessage msg) {
        new Handler(getMainLooper()).post(new Runnable() {

            @Override
            public void run() {
                Toast.makeText(context, msg.custom, Toast.LENGTH_LONG).show();
            }
        });
    }
};

mPushAgent.setMessageHandler(messageHandler);
```

>[!NOTE]
>
>- The content in msg.custom is the received push message
>- The specific protocol format of msg.custom:
>custom=tuya://message?a=view&ct="title"&cc="content"&p=>{}&link=tuyaSmart%3A%2F%2Fbrowser%3Furl%3Dhttp%253A%252F%252Fwww.baidu.com;
>- Use Uri uri = Uri.parse(message); to parse the data to get the required title, content, jump information and other key information

### User Unbind

**Interface Description**

Call Youmeng's method of removing aliases under operations that require the removal of the relationship between the application and the user, such as user logout

```java
mPushAgent.deleteAlias(aliasId, "TUYA_SMART", new UTrack.ICallBack() {
    @Override
    public void onMessage(boolean isSuccess, String message) {
    }
});
```

**Parameter Description**

| Parameters | Description                                   |
| ---------- | --------------------------------------------- |
| aliasId    | Unique id automatically generated by the user |
| ALIAS_TYPE | TUYA_SMART                                    |

### Send Push

#### New operation Push

Tuya Developer Platform-User Operation-Message Center-New Message

![](images/android-push-setting-operation.png)

#### New alarm Push

Tuya Developer Platform-Corresponding Products-Extended Functions-Alarm Settings-New Alarm Rules (App Push Method)

![](images/android-push-setting-warning.png)

